alerts:
  discord_webhook_url: https://discord.com/api/webhooks/XXXX/XXXX
  enabled: true
api:
  base_url: http://127.0.0.1:8787
  key: ''
  account_index: 366110
  api_key_index: null
  max_api_key_index: null
  nonce_management: null
app:
  log_level: INFO
  name: lighter-bot
capture:
  raw_path: logs/ws_raw.jsonl
  write_raw: true
maker:
  dry_run: true
  limits:
    max_cancels: 30
    max_latency_ms: 2000
  loop_delay: 2
  pair: market:2
  size: 0.064
  size_min: 0.061
  size_max: 0.072
  exchange_min_size: 0.061
  # Lower soft cap to trigger earlier (findings: inventory buildup causes bleed)
  inventory_soft_cap: 0.05
  spread_bps: 13.0  # Widened slightly for overnight conservatism (was 12.0)
  price_scale: 1000
  size_scale: 1000
  volatility:
    enabled: true
    low_bps: 6
    high_bps: 22
    # Shortened from 45s to 35s for faster response to volatility changes
    # This helps align internal volatility closer to external market volatility
    ema_halflife_seconds: 35
    min_spread_bps: 7
    max_spread_bps: 13
    min_size_multiplier: 0.7
    max_size_multiplier: 1.1
    pause_threshold_bps: 30
    resume_threshold_bps: 18
    resume_inventory_ratio: 0.25
    high_vol_threshold_bps: 9
    high_vol_size_multiplier: 0.85
    # Pause maker during very low volatility to avoid bleeding on hedging
    # Internal EMA can lag external vol significantly - disable pause for now
    # Bot needs to trade to make money, even in low vol conditions
    # Set to 0 to disable low-vol pause (only high-vol pause at 30bps remains active)
    low_vol_pause_threshold_bps: 0.0
    low_vol_resume_threshold_bps: 0.1
  trend:
    enabled: true
    lookback_seconds: 45
    threshold_bps: 12
    # Lower threshold to trigger earlier on softer downtrends (findings show -$13/window in downtrends)
    down_threshold_bps: 4
    resume_threshold_bps: 6
    extra_spread_bps: 2.5
    # Wider spreads during downtrends to avoid costly fills (findings: downtrends lose $13/window)
    down_extra_spread_bps: 8.0
    down_bias: ask
    # Longer cooldown during downtrends to prevent inventory buildup (findings: inventory = bleed)
    down_cooldown_seconds: 60
    inventory_soft_cap_ratio: 0.6
  regimes:
    min_dwell_seconds: 60
    # Volatility threshold for regime switching:
    # High vol (>= threshold) -> aggressive (better liquidity, fewer hedges needed)
    # Low vol (< threshold) -> defensive (lower liquidity, need careful hedging)
    vol_threshold_bps: 6.0
    aggressive:
      size_multiplier: 1.0
      extra_spread_bps: 0.0
      down_cooldown_seconds: 20
    defensive:
      size_multiplier: 0.7
      extra_spread_bps: 2.0
      # Longer cooldown in defensive regime during downtrends (findings: downtrends problematic)
      down_cooldown_seconds: 60
  exchange_min_notional: 10.5
  pnl_guard:
    enabled: true
    window_seconds: 300
    # Trigger earlier and immediately to prevent deeper losses
    realized_floor_quote: -0.20  # Trigger earlier (was -0.50)
    trigger_consecutive: 1  # Trigger immediately (was 2)
    widen_bps: 6.0  # Wider spreads when engaged (was 4.0)
    size_multiplier: 0.85
    cooldown_seconds: 120
    check_interval_seconds: 15
    max_extra_bps: 10.0  # Allow more aggressive widening (was 8.0)
    min_size_multiplier: 0.6
hedger:
  enabled: true
  dry_run: false
  market: market:2
  # Hedge even earlier to prevent inventory buildup (findings: inventory = bleed, correlation -1.0)
  trigger_units: 0.008  # Hedge earlier to prevent buildup (was 0.010, overnight: inventory still building to 0.075)
  trigger_notional: 4.0
  # Nearly flat target to reduce residual inventory (findings: any inventory costs money)
  target_units: 0.0005  # Flatter target (was 0.001)
  # Smaller max clip to reduce large crosses (findings: large crosses cost $16-18 each)
  max_clip_units: 0.03  # Smaller clips (was 0.04)
  price_offset_bps: 10
  max_slippage_bps: 12
  poll_interval_seconds: 1.0
  cooldown_seconds: 1.5  # Faster response to prevent buildup (was 2.0)
  max_attempts: 3
  retry_backoff_seconds: 2.0
  prefer_passive: true
  # Wait longer for passive fills to reduce costs (findings: large crosses expensive)
  passive_wait_seconds: 0.5
  passive_offset_bps: 2.0
  passive_timeout_seconds: 6.0
  guard_emergency_seconds: 8.0
  guard_emergency_clip_multiplier: 1.1
  guard_emergency_extra_bps: 6.0
  guard_emergency_cooldown_seconds: 0.5
  guard_clip_multiplier: 0.35
  guard_price_offset_bps: 9.0
  guard_max_slippage_bps: 9.0
fees:
  maker_actual_rate: 0.0
  taker_actual_rate: 0.0
  maker_premium_rate: 2.0e-05
  taker_premium_rate: 0.0002
optimizer:
  hysteresis_score_margin: 0.05
  max_spread_bps: 25
  max_switches_per_hour: 12
  min_dwell_s: 120
  min_open_interest: 0
  scan_interval_s: 30
  spread_bps_penalty: 0.02
  top_n: 3
  w_funding: 1.0
  w_oi: 0.2
replay:
  enabled: false
  market_filter: []
  path: logs/ws_raw.jsonl
  speed: 1.0
chaos:
  enabled: false
  latency:
    enabled: true
    probability: 0.3
    min_ms: 50.0
    max_ms: 200.0
    spike_probability: 0.05
    spike_multiplier: 10.0
  reconnect:
    enabled: false
    probability: 0.01
    min_interval_s: 30.0
    max_interval_s: 120.0
  quote_width:
    enabled: true
    probability: 0.2
    min_bps: 30.0
    max_bps: 80.0
  cancel_rate:
    enabled: true
    force_cancels_per_min: 30
telemetry:
  enabled: true
  port: 9100
metrics:
  enabled: true
  ledger_path: data/metrics/fills.jsonl
  archive_dir: data/metrics/archive
  max_bytes: 5242880
  rolling_window_seconds: 21600
watchdogs:
  quote_stale_seconds: 20
  reminder_every_seconds: 300
  ws_stale_seconds: 30
guard:
  price_band_bps: 35
  crossed_book_protection: true
  max_position_units: 0.3
  max_inventory_notional: 50.0
  kill_on_crossed_book: true
  kill_on_inventory_breach: true
  backoff_seconds_on_block: 5
ws:
  fallback_on_fail: true
  max_failures: 3
  url: wss://mainnet.zklighter.elliot.ai/stream
  channels:
  - market_stats/all
  auth_token: ${WS_AUTH_TOKEN:}
  log_mid_interval_s: 1.0
account_listener:
  enabled: true
  debug: true
  ws:
    url: wss://mainnet.zklighter.elliot.ai/stream
    auth_token: ${WS_AUTH_TOKEN:}
    accounts:
    - 366110
mean_reversion:
  enabled: false  # Set to true to enable mean reversion trading
  dry_run: true  # Set to false for live trading
  market: market:2  # SOL market
  # Indicator parameters
  ema_fast_period: 8
  ema_slow_period: 21
  bb_period: 20
  bb_std: 2.0
  rsi_period: 14
  atr_period: 14
  volume_ma_period: 20
  # Entry filters
  bb_touch_threshold: 0.95  # Price must be within 95% of Bollinger Band
  rsi_oversold: 30.0  # RSI threshold for long entries
  rsi_overbought: 70.0  # RSI threshold for short entries
  volume_multiplier: 1.2  # Volume must be 1.2x average
  vol_min_bps: 4.0  # Minimum volatility to trade (avoid dead markets)
  vol_max_bps: 25.0  # Maximum volatility to trade (avoid chaos)
  trend_filter_bps: 15.0  # Max EMA divergence (avoid strong trends)
  # Risk management
  take_profit_bps: 3.0  # Target profit in basis points
  stop_loss_bps: 6.0  # Stop loss in basis points
  max_hold_minutes: 5  # Maximum time to hold position
  risk_per_trade_pct: 1.0  # Risk 1% of capital per trade
  max_position_size: 0.1  # Maximum SOL per trade
  min_position_size: 0.01  # Minimum SOL per trade
